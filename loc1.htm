<!DOCTYPE html>
<html>
<head>
    <title>LOC for a C code</title>
    <style>
       *{
        padding: auto;
        justify-content: center;
        display: content;
       }
        table{
            text-align: center;
            justify-content: center;
            border: none;
            background-color: antiquewhite;
        }
    </style>
</head>
<body>
    <h2>LOC Counter</h2>

    <textarea id="CodeInput" rows="15" cols="70" style="padding:10px;">
/*
  C Program to Find Prime Numbers in a given range.
 */
#include <stdio.h>

// Function to check if a number is prime
int isPrime(int n) {
    int i;

    if (n <= 1) {
        return 0;
    }

    for (i = 2; i <= n / 2; i++) {
        if (n % i == 0) {
            return 0;
        }
    }

    return 1;
}

int main() {
    int limit;
    int j = 0;

    printf("Enter the upper limit: ");
    scanf("%d", &limit);

    printf("\nPrime numbers up to %d are:\n", limit);

    for (j = 1; j <= limit; j++) {
        if (isPrime(j)) {
            printf("%d ", j);
        }
    }
    
    printf("\n");
    return 0;
}
    </textarea>

    <br><br>
    <button onclick="analyze()">Analyze C Program</button>

    <pre id="locResult"></pre>
    <h3> Detected Constructs </h3>
    <table border=".1px black dotted" id="construct">
        <thead>
            <tr><th>Name</th><th>Type of Constructor</th><th>Count for the construcctor </th></tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        function analyze() {
            let code = document.getElementById("CodeInput").value;
            let lines = code.split('\n');

            let total = 0, blank = 0, comment = 0, codeLines = 0;
            let inBlockComment = false;

        // for the line of codes
            for (let raw of lines) {
                total++;
                let line = raw.trim();

                if (line === "") {
                    blank++;
                    continue;
                }

                if (inBlockComment) {
                    comment++;
                    if (line.includes("*/")) {
                        inBlockComment = false;
                    }
                    continue;
                }

                if (line.startsWith("/*")) {
                    comment++;
                    if (!line.includes("*/")) {
                        inBlockComment = true;
                    }
                    continue;
                }

                if (line.startsWith("//")) {
                    comment++;
                    continue;
                }

                if (line.includes("//")) {
                    codeLines++;
                    continue;
                }

                codeLines++;
            }

            document.getElementById("locResult").textContent =
                `Total lines   : ${total}\n` +
                `Blank lines   : ${blank}\n` +
                `Comment lines : ${comment}\n` +
                `Code lines    : ${codeLines}`;

            // Construct Analysis
            const keywords=["int","float","char","double","return","for","while","if","else","void"];
            const operators=["+","-","*","/","%","&&","||"];
            const constructs={};

            const tokens=code.split(/[\s;(){}<>\[\].]+/);

            tokens.forEach(token=>{
                if(!token) return;

                if(keywords.includes(token)){
                    addConstruct(token,"Keyword");
                }
                else if(operators.includes(token)){
                    addConstruct(token,"Operator");
                }
                else if(token==="#include"){
                    addConstruct(token,"Preprocessor Statement");
                }
                else if(token==="main"){
                    addConstruct(token,"Function");
                }
                else if(token.endsWith(".h")){
                    addConstruct(token,"Header File");
                }
                else if(/^[a-zA-Z]\w*\[.*\]$/.test(token)){
                    addConstruct(token,"Array Variable");
                }
                else if(/^[a-zA-Z]\w*$/.test(token)){
                    addConstruct(token,"Variable");
                }
            });

            function addConstruct(name,type){
                if(!constructs[name]){
                    constructs[name]={type:type, count:1};
                } else {
                    constructs[name].count++;
                }
            }

            //  for displaying result 
            const tbody=document.querySelector('#construct tbody');
            tbody.innerHTML= " ";
            for(let name in constructs){
                const row=`<tr>
                    <td>${name}</td>
                    <td>${constructs[name].type}</td>
                    <td>${constructs[name].count}</td>
                </tr>`;
                tbody.innerHTML+=row;
            }
        }
    </script>
</body>
</html>
